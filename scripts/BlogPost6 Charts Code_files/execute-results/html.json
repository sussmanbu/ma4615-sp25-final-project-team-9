{
  "hash": "1a92dcad815ada7fcbebf12eba6bc1c0",
  "result": {
    "engine": "knitr",
    "markdown": "#after running blog5 qmd\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nenrollment_clean <- read_csv(\"dataset/clean_data file/enrollment_clean.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 234\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (226): SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X, SCH_ENR_AM_M, SCH_ENR_A...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n#Preview results\nenrollment_clean %>%\n  filter(LEA_STATE == \"MA\") %>%\n  select(SCH_NAME, Total_Students)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,868 × 2\n   SCH_NAME                       Total_Students\n   <chr>                                   <dbl>\n 1 Quabbin Regional High School              619\n 2 Quabbin Regional Middle School            532\n 3 Hardwick Elementary                       187\n 4 Hubbardston Center                        307\n 5 New Braintree Grade                        47\n 6 Oakham Center                             124\n 7 Ruggles Lane                              374\n 8 Knox Trail Middle School                  406\n 9 East Brookfield Elementary                145\n10 David Prouty High                         343\n# ℹ 1,858 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(dplyr)\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/louieblile/Desktop/Rstudio/ma4615-sp25-final-project-team-9\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nharassment <- read_csv(\"dataset/clean_data file/Harassment_and_Bullying_clean.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat <- vroom(...)\n  problems(dat)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 159\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (5): LEA_STATE, LEA_STATE_NAME, LEA_NAME, NAME, JJ\ndbl (154): LEAID, SCHID, COMBOKEY, HBALLEGATIONS_SEX, HBALLEGATIONS_ORI, HBA...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# STEP 1: Clean the support staff data\nsupport_clean <- support |>\n  mutate(across(c(SCH_FTECOUNSELORS, SCH_FTESERVICES_PSY, SCH_FTESECURITY_GUA),\n                ~ ifelse(. < 0, 0, .)))\n\n# STEP 2: Clean the harassment & bullying data\nharass_clean <- harassment %>%\n  mutate(across(c(\n    HBALLEGATIONS_SEX,\n    HBALLEGATIONS_REL,\n    HBALLEGATIONS_RAC,\n    HBALLEGATIONS_DIS,\n    HBALLEGATIONS_ORI\n  ), ~ ifelse(. < 0, 0, .))) %>%\n  rowwise() %>%\n  mutate(Total_Allegations = sum(\n    c_across(c(\n      HBALLEGATIONS_SEX,\n      HBALLEGATIONS_REL,\n      HBALLEGATIONS_RAC,\n      HBALLEGATIONS_DIS,\n      HBALLEGATIONS_ORI\n    )), na.rm = TRUE\n  )) %>%\n  ungroup() %>%\n  select(COMBOKEY, Total_Allegations)\n\nenrollment_clean <- enrollment_clean %>%\n  mutate(COMBOKEY = as.character(COMBOKEY))\n\nharass_clean <- harass_clean %>%\n  mutate(COMBOKEY = as.character(COMBOKEY))\n\n# STEP 3: Join all datasets — enrollment + support + harassment\ncombined_ma <- enrollment_clean |>\n  filter(LEA_STATE == \"MA\") |>\n  select(COMBOKEY, SCH_NAME, Total_Students) %>%\n  inner_join(support_clean, by = \"COMBOKEY\") %>%\n  inner_join(harass_clean, by = \"COMBOKEY\") %>%\n  mutate(\n    allegations_per_100 = Total_Allegations / Total_Students * 100\n  )\n\n# STEP 4: Check correlations\ncombined_ma %>%\n  select(allegations_per_100, SCH_FTECOUNSELORS, SCH_FTESERVICES_PSY, SCH_FTESECURITY_GUA) %>%\n  cor(use = \"complete.obs\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    allegations_per_100 SCH_FTECOUNSELORS SCH_FTESERVICES_PSY\nallegations_per_100          1.00000000        0.02193542          -0.0462751\nSCH_FTECOUNSELORS            0.02193542        1.00000000           0.2191212\nSCH_FTESERVICES_PSY         -0.04627510        0.21912121           1.0000000\nSCH_FTESECURITY_GUA         -0.00407359        0.31641785           0.0785435\n                    SCH_FTESECURITY_GUA\nallegations_per_100         -0.00407359\nSCH_FTECOUNSELORS            0.31641785\nSCH_FTESERVICES_PSY          0.07854350\nSCH_FTESECURITY_GUA          1.00000000\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Log-Linear Regression for further check\ncombined_ma <- combined_ma %>%\n  mutate(log_allegations = log(allegations_per_100 + 0.01))\n\nlog_model <- lm(log_allegations ~ SCH_FTECOUNSELORS + SCH_FTESERVICES_PSY + SCH_FTESECURITY_GUA,\n                data = combined_ma)\n\nsummary(log_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = log_allegations ~ SCH_FTECOUNSELORS + SCH_FTESERVICES_PSY + \n    SCH_FTESECURITY_GUA, data = combined_ma)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-2.425 -1.123 -1.011  1.591  6.400 \n\nCoefficients:\n                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)         -3.659850   0.062685 -58.385  < 2e-16 ***\nSCH_FTECOUNSELORS    0.098636   0.016759   5.886 4.72e-09 ***\nSCH_FTESERVICES_PSY -0.032844   0.039920  -0.823    0.411    \nSCH_FTESECURITY_GUA -0.005787   0.051593  -0.112    0.911    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.88 on 1792 degrees of freedom\n  (61 observations deleted due to missingness)\nMultiple R-squared:  0.02083,\tAdjusted R-squared:  0.01919 \nF-statistic:  12.7 on 3 and 1792 DF,  p-value: 3.233e-08\n```\n\n\n:::\n\n```{.r .cell-code}\n# Base residual plot\nplot(log_model$fitted.values, log_model$residuals,\n     xlab = \"Fitted Values (log allegations)\",\n     ylab = \"Residuals\",\n     main = \"Residuals vs Fitted Values\")\nabline(h = 0, col = \"red\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](BlogPost6-Charts-Code_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(log_model$residuals)\nqqline(log_model$residuals, col = \"lightblue\")\n```\n\n::: {.cell-output-display}\n![](BlogPost6-Charts-Code_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(readr)\n\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nharassment <- read_csv(\"dataset/Harassment and Bullying.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 159\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (151): SCH_HBALLEGATIONS_SEX, SCH_HBALLEGATIONS_ORI, SCH_HBALLEGATIONS_R...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nenroll = read_csv(\"dataset/Enrollment.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 233\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (225): SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X, SCH_ENR_AM_M, SCH_ENR_A...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nma_schools <- enroll |>\n  filter(LEA_STATE_NAME == \"MASSACHUSETTS\")\nmerged <- ma_schools |>\n  inner_join(harassment, by = \"COMBOKEY\") \nmerged <- merged %>%\n  mutate(\n    total_allegations = rowSums(select(., SCH_HBALLEGATIONS_SEX, SCH_HBALLEGATIONS_RAC, SCH_HBALLEGATIONS_DIS), na.rm = TRUE)\n  )\n\n# Calculate total enrollment\nmerged <- merged %>%\n  mutate(\n    total_enrollment = TOT_ENR_M + TOT_ENR_F + TOT_ENR_X,\n    allegations_per_100 = (total_allegations / total_enrollment) * 100\n  )\ntop_schools <- merged %>%\n  arrange(desc(allegations_per_100)) %>%\n  select(SCH_NAME.x, LEA_NAME.x, allegations_per_100, total_enrollment, total_allegations) %>%\n  head(10)\n\ntop_schools\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n   SCH_NAME.x  LEA_NAME.x allegations_per_100 total_enrollment total_allegations\n   <chr>       <chr>                    <dbl>            <dbl>             <dbl>\n 1 Abington E… Abington                   100              -27               -27\n 2 Carol Hueb… Acton-Box…                 100              -27               -27\n 3 Agawam Ear… Agawam                     100              -27               -27\n 4 Shawsheen … Andover                    100              -27               -27\n 5 Menotomy P… Arlington                  100              -27               -27\n 6 William Pi… Ashland                    100              -27               -27\n 7 Early Lear… Attleboro                  100              -27               -27\n 8 Enoch Cobb… Barnstable                 100              -27               -27\n 9 Bellingham… Bellingham                 100              -27               -27\n10 McKeown Sc… Beverly                    100              -27               -27\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmerged <- merged %>%\n  mutate(\n    total_enrollment = TOT_ENR_M + TOT_ENR_F + TOT_ENR_X,\n    total_idea = TOT_IDEAENR_M + TOT_IDEAENR_F + TOT_IDEAENR_X,\n    total_504 = TOT_504ENR_M + TOT_504ENR_F + TOT_504ENR_X,\n    total_el = TOT_ELENR_M + TOT_ELENR_F + TOT_ELENR_X\n  )\nmerged <- merged %>%\n  mutate(\n    pct_disabilities = (total_idea + total_504) / total_enrollment,\n    pct_el = total_el / total_enrollment,\n    allegations_per_100 = (total_allegations / total_enrollment) * 100\n  )\ncorrelation_results <- merged %>%\n  summarise(\n    corr_pct_disabilities = cor(pct_disabilities, allegations_per_100, use = \"complete.obs\"),\n    corr_pct_el = cor(pct_el, allegations_per_100, use = \"complete.obs\")\n  )\n\ncorrelation_results\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  corr_pct_disabilities corr_pct_el\n                  <dbl>       <dbl>\n1                 0.166       0.126\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# Disabilities\nggplot(merged, aes(x = pct_disabilities, y = allegations_per_100)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\") +\n  labs(\n    title = \"Allegations per 100 Students vs. % with Disabilities\",\n    x = \"Percentage of Students with Disabilities\",\n    y = \"Allegations per 100 Students\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](BlogPost6-Charts-Code_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(merged, aes(x = pct_el, y = allegations_per_100)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\") +\n  labs(\n    title = \"Allegations per 100 Students vs. % English Learners\",\n    x = \"Percentage of English Learners\",\n    y = \"Allegations per 100 Students\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing non-finite outside the scale range (`stat_smooth()`).\nRemoved 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](BlogPost6-Charts-Code_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Total students with disabilities (IDEA + 504)\nmerged <- merged %>%\n  mutate(\n    total_disabilities = total_idea + total_504,\n    allegations_per_100_disabilities = (total_allegations / total_disabilities) * 100\n  )\nmerged <- merged %>%\n  mutate(\n    total_black = SCH_ENR_BL_M + SCH_ENR_BL_F + SCH_ENR_BL_X,\n    allegations_per_100_black = (total_allegations / total_black) * 100\n  )\nggplot(merged, aes(x = pct_disabilities, y = allegations_per_100_disabilities)) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](BlogPost6-Charts-Code_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::",
    "supporting": [
      "BlogPost6-Charts-Code_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}