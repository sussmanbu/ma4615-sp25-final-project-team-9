{
  "hash": "d3fa79d931fbf0b98d77f04768f0c87c",
  "result": {
    "engine": "knitr",
    "markdown": "\n---\ntitle: \"Suspension Analysis by State\"\nformat: html\nexecute:\n  freeze: auto\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggpmisc)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: ggpp\nRegistered S3 methods overwritten by 'ggpp':\n  method                  from   \n  heightDetails.titleGrob ggplot2\n  widthDetails.titleGrob  ggplot2\n\nAttaching package: 'ggpp'\n\nThe following object is masked from 'package:ggplot2':\n\n    annotate\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load datasets\nsuspensions <- read_csv(\"dataset/Suspensions.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 189\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (181): SCH_PSOOSINSTANCES_ALL, SCH_PSOOSINSTANCES_IDEA, SCH_PSDISC_SINGO...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Clean and prepare numeric fields\nsuspensions <- suspensions %>%\n  mutate(\n    SCH_PSOOSINSTANCES_ALL = as.numeric(SCH_PSOOSINSTANCES_ALL),\n    TOTAL_ENROLLMENT = as.numeric(TOT_PSDISC_SINGOOS_M + TOT_PSDISC_SINGOOS_F)\n  ) %>%\n  filter(\n    !is.na(SCH_PSOOSINSTANCES_ALL), SCH_PSOOSINSTANCES_ALL >= 0,\n    !is.na(TOTAL_ENROLLMENT), TOTAL_ENROLLMENT > 0\n  ) %>%\n  mutate(\n    suspensions_per_100 = SCH_PSOOSINSTANCES_ALL / TOTAL_ENROLLMENT * 100\n  )\n\nsupport <- support %>%\n  mutate(\n    SCH_FTECOUNSELORS = as.numeric(SCH_FTECOUNSELORS),\n    SCH_FTESERVICES_PSY = as.numeric(SCH_FTESERVICES_PSY),\n    SCH_FTESECURITY_GUA = as.numeric(SCH_FTESECURITY_GUA),\n    TOTAL_SUPPORT = SCH_FTECOUNSELORS + SCH_FTESERVICES_PSY + SCH_FTESECURITY_GUA\n  ) %>%\n  filter(!is.na(TOTAL_SUPPORT), TOTAL_SUPPORT > 0)\n\n# Merge datasets by SCHID\nmerged <- inner_join(suspensions, support, by = \"SCHID\") %>%\n  filter(!is.na(suspensions_per_100), !is.na(TOTAL_SUPPORT), TOTAL_SUPPORT > 0)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in inner_join(suspensions, support, by = \"SCHID\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1420 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Create log-log plot\nmerged %>%\n  ggplot(aes(x = TOTAL_SUPPORT, y = suspensions_per_100)) +\n  geom_point(alpha = 0.3) +\n  scale_x_log10() +\n  scale_y_log10() +\n  geom_smooth(method = \"lm\", formula = y ~ x, color = \"darkgreen\", se = TRUE) +\n  stat_poly_eq(\n    aes(label = paste(..eq.label.., ..rr.label.., sep = \"~~~\")),\n    formula = y ~ x,\n    parse = TRUE,\n    label.x.npc = \"right\",\n    label.y.npc = \"top\",\n    size = 5,\n    color = \"black\"\n  ) +\n  labs(\n    x = \"Log(Total School Support Staff)\",\n    y = \"Log(Suspensions per 100 Students)\",\n    title = \"Log-Log Relationship Between School Support and Suspension Rates\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in stat_poly_eq(aes(label = paste(..eq.label.., ..rr.label.., sep =\n\"~~~\")), : Ignoring unknown parameters: `label.x.npc` and `label.y.npc`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The dot-dot notation (`..eq.label..`) was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(eq.label)` instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in scale_y_log10(): log-10 transformation introduced infinite values.\nlog-10 transformation introduced infinite values.\nlog-10 transformation introduced infinite values.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1530 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1530 rows containing non-finite outside the scale range\n(`stat_poly_eq()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n## Interpretation\nThis plot explores the log-log relationship between the total number of support staff (counselors, psychologists, and security guards) and the rate of out-of-school suspensions per 100 students. The regression line and R² value help evaluate whether increased support staffing is associated with lower suspension rates. A weak or flat slope would suggest limited association, while a downward trend might indicate that more support staff correlates with fewer suspensions. This analysis remains observational, and causality should not be inferred\n\n\n---\ntitle: \"Suspension Analysis by State\"\nformat: html\nexecute:\n  freeze: auto\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(ggpmisc)\n\n# Load datasets\nsuspensions <- read_csv(\"dataset/Suspensions.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 189\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (181): SCH_PSOOSINSTANCES_ALL, SCH_PSOOSINSTANCES_IDEA, SCH_PSDISC_SINGO...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nharassment <- read_csv(\"dataset/clean_data file/Harassment_and_Bullying_clean.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat <- vroom(...)\n  problems(dat)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 159\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (5): LEA_STATE, LEA_STATE_NAME, LEA_NAME, NAME, JJ\ndbl (154): LEAID, SCHID, COMBOKEY, HBALLEGATIONS_SEX, HBALLEGATIONS_ORI, HBA...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# === MASSACHUSETTS ANALYSIS === #\n\n# Prepare suspensions data (Massachusetts only)\nsusp_ma <- suspensions %>%\n  filter(LEA_STATE == \"MA\") %>%\n  mutate(\n    SCHID = as.character(SCHID),\n    SCH_PSOOSINSTANCES_ALL = as.numeric(SCH_PSOOSINSTANCES_ALL),\n    TOTAL_ENROLLMENT = as.numeric(TOT_PSDISC_SINGOOS_M + TOT_PSDISC_SINGOOS_F)\n  ) %>%\n  filter(!is.na(SCH_PSOOSINSTANCES_ALL), !is.na(TOTAL_ENROLLMENT), TOTAL_ENROLLMENT > 0) %>%\n  mutate(suspensions_per_100 = SCH_PSOOSINSTANCES_ALL / TOTAL_ENROLLMENT * 100)\n\n# Prepare support data\nsupport <- support %>%\n  mutate(\n    SCH_FTECOUNSELORS = as.numeric(SCH_FTECOUNSELORS),\n    SCH_FTESERVICES_PSY = as.numeric(SCH_FTESERVICES_PSY),\n    SCH_FTESECURITY_GUA = as.numeric(SCH_FTESECURITY_GUA),\n    TOTAL_SUPPORT = SCH_FTECOUNSELORS + SCH_FTESERVICES_PSY + SCH_FTESECURITY_GUA\n  ) %>%\n  filter(!is.na(SCHID), !is.na(TOTAL_SUPPORT), TOTAL_SUPPORT > 0)\n\n# Merge suspension + support for MA\nmerged_susp_ma <- inner_join(susp_ma, support, by = \"SCHID\")\n\n# Plot 1: School Support vs Suspensions in Massachusetts\nmerged_susp_ma %>%\n  ggplot(aes(x = TOTAL_SUPPORT, y = suspensions_per_100)) +\n  geom_point(alpha = 0.3) +\n  scale_x_log10() +\n  scale_y_log10() +\n  geom_smooth(method = \"lm\", formula = y ~ x, color = \"darkgreen\", se = TRUE) +\n  stat_poly_eq(\n    aes(label = paste(..eq.label.., ..rr.label.., sep = \"~~~\")),\n    formula = y ~ x,\n    parse = TRUE,\n    label.x.npc = \"right\",\n    label.y.npc = \"top\",\n    size = 5,\n    color = \"black\"\n  ) +\n  labs(\n    x = \"Log(Total School Support Staff)\",\n    y = \"Log(Suspensions per 100 Students)\",\n    title = \"MA: Log-Log Relationship Between School Support and Suspensions\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in stat_poly_eq(aes(label = paste(..eq.label.., ..rr.label.., sep =\n\"~~~\")), : Ignoring unknown parameters: `label.x.npc` and `label.y.npc`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# === HARASSMENT ANALYSIS FOR MA === #\n\n# Prepare harassment dataset (Massachusetts only)\nharass_ma <- harassment %>%\n  filter(LEA_STATE == \"MA\") %>%\n  mutate(\n    SCHID = as.character(SCHID),\n    HBALLEGATIONS_TOTAL = HBALLEGATIONS_RAC + HBALLEGATIONS_REL + HBALLEGATIONS_ORI,\n    TOTAL_ENROLLMENT = rowSums(across(starts_with(\"SCH_ENR_\")), na.rm = TRUE),\n    allegations_per_100 = HBALLEGATIONS_TOTAL / TOTAL_ENROLLMENT * 100\n  ) %>%\n  filter(!is.na(SCHID), !is.na(allegations_per_100), allegations_per_100 >= 0)\n\n# Merge harassment + support\nmerged_harass_ma <- inner_join(harass_ma, support, by = \"SCHID\") %>%\n  filter(!is.na(TOTAL_SUPPORT), TOTAL_SUPPORT > 0)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in inner_join(harass_ma, support, by = \"SCHID\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 12 of `x` matches multiple rows in `y`.\nℹ Row 3516 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Plot 2: School Support vs Harassment in Massachusetts\nmerged_harass_ma %>%\n  ggplot(aes(x = TOTAL_SUPPORT, y = allegations_per_100)) +\n  geom_point(alpha = 0.3) +\n  scale_x_log10() +\n  scale_y_log10() +\n  geom_smooth(method = \"lm\", formula = y ~ x, color = \"firebrick\", se = TRUE) +\n  stat_poly_eq(\n    aes(label = paste(..eq.label.., ..rr.label.., sep = \"~~~\")),\n    formula = y ~ x,\n    parse = TRUE,\n    label.x.npc = \"right\",\n    label.y.npc = \"top\",\n    size = 5,\n    color = \"black\"\n  ) +\n  labs(\n    x = \"Log(Total School Support Staff)\",\n    y = \"Log(Harassment Allegations per 100 Students)\",\n    title = \"MA: Log-Log Relationship Between School Support and Harassment\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in stat_poly_eq(aes(label = paste(..eq.label.., ..rr.label.., sep =\n\"~~~\")), : Ignoring unknown parameters: `label.x.npc` and `label.y.npc`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 573 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 573 rows containing non-finite outside the scale range\n(`stat_poly_eq()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n## Interpretation\nThese two plots explore the relationship between school support staffing and student outcomes in **Massachusetts**. The first chart looks at how suspensions vary with support levels, while the second does the same for harassment and bullying allegations. Although the visualizations use a log-log scale to highlight proportional trends, any observed patterns should be interpreted cautiously given the observational nature of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggpmisc)\n\n# Load the dataset\ndata <- read_csv(\"dataset/clean_data file/merged_harassment_dataset.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 395\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (5): LEA_STATE, LEA_STATE_NAME, LEA_NAME, NAME, JJ\ndbl (390): LEAID, SCHID, COMBOKEY, HBALLEGATIONS_SEX, HBALLEGATIONS_ORI, HBA...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Filter for Massachusetts and compute necessary fields\ndata_ma <- data %>%\n  filter(LEA_STATE == \"MA\") %>%\n  mutate(\n    total_support = SCH_FTECOUNSELORS + SCH_FTESERVICES_PSY + SCH_FTESECURITY_GUA,\n    total_enrollment = rowSums(across(starts_with(\"SCH_ENR_\")), na.rm = TRUE),\n    allegations_per_100 = (HBALLEGATIONS_RAC + HBALLEGATIONS_REL + HBALLEGATIONS_ORI) / total_enrollment * 100\n  ) %>%\n  filter(total_support > 0, total_enrollment > 0, allegations_per_100 > 0)\n\n# Plot: School Support vs Harassment in MA\nggplot(data_ma, aes(x = total_support, y = allegations_per_100)) +\n  geom_point(alpha = 0.3) +\n  scale_x_log10() +\n  scale_y_log10() +\n  geom_smooth(method = \"lm\", formula = y ~ x, color = \"forestgreen\", se = TRUE) +\n  stat_poly_eq(\n    aes(label = paste(..eq.label.., ..rr.label.., sep = \"~~~\")),\n    formula = y ~ x,\n    parse = TRUE,\n    label.x.npc = \"right\",\n    label.y.npc = \"top\",\n    size = 5,\n    color = \"black\"\n  ) +\n  labs(\n    x = \"Log(Total School Support Staff)\",\n    y = \"Log(Harassment Allegations per 100 Students)\",\n    title = \"MA: Log-Log Relationship Between School Support and Harassment Reports\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in stat_poly_eq(aes(label = paste(..eq.label.., ..rr.label.., sep =\n\"~~~\")), : Ignoring unknown parameters: `label.x.npc` and `label.y.npc`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# Load school support data\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Filter for Massachusetts and compute total support\nsupport_ma <- support %>%\n  filter(LEA_STATE == \"MA\") %>%\n  mutate(\n    TOTAL_SUPPORT = as.numeric(SCH_FTECOUNSELORS) +\n                    as.numeric(SCH_FTESERVICES_PSY) +\n                    as.numeric(SCH_FTESECURITY_GUA)\n  ) %>%\n  filter(!is.na(TOTAL_SUPPORT))  # Remove missing values\n\n# View summary of support levels\nsummary(support_ma$TOTAL_SUPPORT)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n -9.000   1.167   2.100   3.267   4.000  37.360 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Optional: Top 10 schools by support staff\nsupport_ma %>%\n  select(SCH_NAME, TOTAL_SUPPORT) %>%\n  arrange(desc(TOTAL_SUPPORT)) %>%\n  slice_head(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 2\n   SCH_NAME                                TOTAL_SUPPORT\n   <chr>                                           <dbl>\n 1 Newbury Elementary                               37.4\n 2 B M C Durfee High                                33.8\n 3 Weymouth High School                             32.7\n 4 Gr Lowell Regional Vocational Technical          30  \n 5 Brockton High                                    29.8\n 6 Cambridge Rindge and Latin                       29.4\n 7 Lawrence High School                             25.8\n 8 New Bedford High                                 25.8\n 9 Lowell High                                      25.2\n10 Taunton High                                     21.5\n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define consistent race color palette\nrace_colors <- c(\n  \"Asian\" = \"#66c2a5\",\n  \"Black\" = \"#fc8d62\",\n  \"Hispanic\" = \"#8da0cb\",\n  \"White\" = \"#e78ac3\",\n  \"Other\" = \"#a6d854\",\n  \"Native American\" = \"#ffd92f\",\n  \"Hawaiian Pi\" = \"#e5c494\",\n  \"Two Or More\" = \"#b3b3b3\"\n)\n\nlibrary(tidyverse)\n\n# Load datasets\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nenrollment <- read_csv(\"dataset/Enrollment.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 233\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (225): SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X, SCH_ENR_AM_M, SCH_ENR_A...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# === Step 1: Prepare Support Data ===\nsupport_ma <- support %>%\n  filter(LEA_STATE == \"MA\") %>%\n  mutate(\n    TOTAL_SUPPORT = as.numeric(SCH_FTECOUNSELORS) +\n                    as.numeric(SCH_FTESERVICES_PSY) +\n                    as.numeric(SCH_FTESECURITY_GUA)\n  ) %>%\n  filter(!is.na(TOTAL_SUPPORT)) %>%\n  select(SCHID, SCH_NAME, TOTAL_SUPPORT)\n\n# === Step 2: Get Top 5 Schools by Support Staff ===\ntop5_support <- support_ma %>%\n  arrange(desc(TOTAL_SUPPORT)) %>%\n  slice_head(n = 5)\n\n# === Step 3: Prepare Enrollment Data ===\nenrollment_cols <- c(\n  \"SCH_ENR_HI_M\", \"SCH_ENR_HI_F\",\n  \"SCH_ENR_AM_M\", \"SCH_ENR_AM_F\",\n  \"SCH_ENR_AS_M\", \"SCH_ENR_AS_F\",\n  \"SCH_ENR_HP_M\", \"SCH_ENR_HP_F\",\n  \"SCH_ENR_BL_M\", \"SCH_ENR_BL_F\",\n  \"SCH_ENR_WH_M\", \"SCH_ENR_WH_F\",\n  \"SCH_ENR_TR_M\", \"SCH_ENR_TR_F\"\n)\n\nenroll_ma <- enrollment %>%\n  filter(SCHID %in% top5_support$SCHID) %>%\n  mutate(\n    Hispanic = SCH_ENR_HI_M + SCH_ENR_HI_F,\n    Native_American = SCH_ENR_AM_M + SCH_ENR_AM_F,\n    Asian = SCH_ENR_AS_M + SCH_ENR_AS_F,\n    Hawaiian_PI = SCH_ENR_HP_M + SCH_ENR_HP_F,\n    Black = SCH_ENR_BL_M + SCH_ENR_BL_F,\n    White = SCH_ENR_WH_M + SCH_ENR_WH_F,\n    Two_or_More = SCH_ENR_TR_M + SCH_ENR_TR_F,\n    TOTAL_ENROLLMENT = rowSums(across(all_of(enrollment_cols)), na.rm = TRUE)\n  ) %>%\n  mutate(across(Hispanic:Two_or_More, ~ (. / TOTAL_ENROLLMENT) * 100, .names = \"{.col}_pct\")) %>%\n  select(SCHID, Hispanic_pct, Native_American_pct, Asian_pct, Hawaiian_PI_pct,\n         Black_pct, White_pct, Two_or_More_pct)\n\n# === Step 4: Merge and Reshape ===\nmerged_demo <- left_join(top5_support, enroll_ma, by = \"SCHID\")\n\ndemo_long <- merged_demo %>%\n  select(SCH_NAME, ends_with(\"_pct\")) %>%\n  pivot_longer(\n    cols = -SCH_NAME,\n    names_to = \"Race\",\n    values_to = \"Percent\"\n  ) %>%\n  mutate(Race = str_remove(Race, \"_pct\") %>% str_replace_all(\"_\", \" \") %>% str_to_title())\n\n# === Step 5: Plot ===\nggplot(demo_long, aes(x = SCH_NAME, y = Percent, fill = Race)) +\n  geom_bar(stat = \"identity\", position = \"stack\") +\n  scale_y_continuous(limits = c(0, 100), labels = scales::percent_format(scale = 1)) +\n  labs(\n    title = \"Top 5 MA Schools by Support Staff: Racial Demographic Breakdown\",\n    x = \"School Name\",\n    y = \"Percent of Total Enrollment\"\n  ) +\n  theme_minimal() +\n  scale_fill_brewer(palette = \"Set3\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 769 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# Load datasets\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nenrollment <- read_csv(\"dataset/Enrollment.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 233\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (225): SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X, SCH_ENR_AM_M, SCH_ENR_A...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Filter for Massachusetts only\nsupport_ma <- support %>% filter(LEA_STATE == \"MA\")\nenrollment_ma <- enrollment %>% filter(LEA_STATE == \"MA\")\n\n# Calculate total support staff\nsupport_ma <- support_ma %>%\n  mutate(Total_Support = rowSums(select(., starts_with(\"SCH_FTE\")), na.rm = TRUE)) %>%\n  select(SCHID, SCH_NAME, Total_Support)\n\n# Get bottom 5 schools with lowest support staff\nbottom5 <- support_ma %>%\n  arrange(Total_Support) %>%\n  slice_head(n = 5)\n\n# Filter enrollment for bottom 5 schools\nenrollment_bottom5 <- enrollment_ma %>% filter(SCHID %in% bottom5$SCHID)\n\n# Calculate racial breakdown with safe sums\nrace_table_bottom <- enrollment_bottom5 %>%\n  mutate(\n    Total_Enrollment = pmax(rowSums(select(., TOT_ENR_M, TOT_ENR_F, TOT_ENR_X), na.rm = TRUE), 1),\n    Asian = pmax(rowSums(select(., SCH_ENR_AS_M, SCH_ENR_AS_F, SCH_ENR_AS_X), na.rm = TRUE), 0),\n    Black = pmax(rowSums(select(., SCH_ENR_BL_M, SCH_ENR_BL_F, SCH_ENR_BL_X), na.rm = TRUE), 0),\n    Hispanic = pmax(rowSums(select(., SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X), na.rm = TRUE), 0),\n    White = pmax(rowSums(select(., SCH_ENR_WH_M, SCH_ENR_WH_F, SCH_ENR_WH_X), na.rm = TRUE), 0),\n    Other = pmax(rowSums(select(., SCH_ENR_AM_M, SCH_ENR_AM_F, SCH_ENR_AM_X,\n                                SCH_ENR_HP_M, SCH_ENR_HP_F, SCH_ENR_HP_X,\n                                SCH_ENR_TR_M, SCH_ENR_TR_F, SCH_ENR_TR_X), na.rm = TRUE), 0)\n  ) %>%\n  mutate(\n    Asian = round(Asian / Total_Enrollment * 100, 1),\n    Black = round(Black / Total_Enrollment * 100, 1),\n    Hispanic = round(Hispanic / Total_Enrollment * 100, 1),\n    White = round(White / Total_Enrollment * 100, 1),\n    Other = round(Other / Total_Enrollment * 100, 1)\n  ) %>%\n  select(SCH_NAME, Asian, Black, Hispanic, White, Other) %>%\n  arrange(match(SCH_NAME, bottom5$SCH_NAME))  # Match order\n\n# Print the table\nprint(race_table_bottom)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 6\n   SCH_NAME                                Asian Black Hispanic White Other\n   <chr>                                   <dbl> <dbl>    <dbl> <dbl> <dbl>\n 1 Worcester Secure Treatment                0     0        0     0       0\n 2 Commonwealth Secure Detention             0     0        0     0       0\n 3 Sharp Transistion Revocation Unit         0     0        0     0       0\n 4 Butler Center                             0     0        0     0       0\n 5 Brockton Revocation                       0     0        0     0       0\n 6 Roxbury Prep High School - Upper Campus   0    62.2     30.1   0       0\n 7 Roxbury Prep Dorchester Campus            0    49.1     45.9   0       0\n 8 Kennedy Academy for Health Careers        0    35.1     54.3   2.1     0\n 9 UP Academy Boston                         2.3  42.1     44     1       0\n10 The B.R.I.D.G.E. Program                  0     0       46.7   6.7     0\n```\n\n\n:::\n\n```{.r .cell-code}\n# === Step 1: Filter out rows with all race counts == 0\nrace_table_bottom_clean <- race_table_bottom %>%\n  filter(Asian + Black + Hispanic + White + Other > 0)\n\n# === Step 2: Convert to long format for plotting\nrace_long_bottom <- race_table_bottom_clean %>%\n  pivot_longer(cols = Asian:Other, names_to = \"Race\", values_to = \"Percent\")\n\n# === Step 3: Plot\nggplot(race_long_bottom, aes(x = SCH_NAME, y = Percent, fill = Race)) +\n  geom_bar(stat = \"identity\", position = \"stack\") +\n  scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +\n  labs(\n    title = \"Racial Demographics of MA Schools with Top 5 Lowest School Support Staff\",\n    x = \"School Name\",\n    y = \"Percent of Total Enrollment\"\n  ) +\n  theme_minimal() +\n  scale_fill_manual(values = race_colors) +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# Load datasets\nsupport <- read_csv(\"dataset/School Support.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMBO...\ndbl (11): SCH_FTESECURITY_LEO, SCH_FTESECURITY_GUA, SCH_FTETEACH_TOT, SCH_FT...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nenrollment <- read_csv(\"dataset/Enrollment.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 98010 Columns: 233\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (8): LEA_STATE, LEA_STATE_NAME, LEAID, LEA_NAME, SCHID, SCH_NAME, COMB...\ndbl (225): SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X, SCH_ENR_AM_M, SCH_ENR_A...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Filter for Massachusetts\nsupport_ma <- support %>% filter(LEA_STATE == \"MA\")\nenrollment_ma <- enrollment %>% filter(LEA_STATE == \"MA\")\n\n# Calculate total support staff per school\nsupport_ma <- support_ma %>%\n  mutate(Total_Support = rowSums(select(., starts_with(\"SCH_FTE\")), na.rm = TRUE)) %>%\n  select(SCHID, SCH_NAME, Total_Support)\n\n# Get top 5 schools with highest support staff\ntop5 <- support_ma %>%\n  arrange(desc(Total_Support)) %>%\n  slice_head(n = 5)\n\n# Filter enrollment for those schools\nenrollment_top5 <- enrollment_ma %>% filter(SCHID %in% top5$SCHID)\n\n# Clean and calculate race counts and percentages\nrace_table <- enrollment_top5 %>%\n  mutate(\n    Total_Enrollment = pmax(rowSums(select(., TOT_ENR_M, TOT_ENR_F, TOT_ENR_X), na.rm = TRUE), 1),\n    Asian = pmax(rowSums(select(., SCH_ENR_AS_M, SCH_ENR_AS_F, SCH_ENR_AS_X), na.rm = TRUE), 0),\n    Black = pmax(rowSums(select(., SCH_ENR_BL_M, SCH_ENR_BL_F, SCH_ENR_BL_X), na.rm = TRUE), 0),\n    Hispanic = pmax(rowSums(select(., SCH_ENR_HI_M, SCH_ENR_HI_F, SCH_ENR_HI_X), na.rm = TRUE), 0),\n    White = pmax(rowSums(select(., SCH_ENR_WH_M, SCH_ENR_WH_F, SCH_ENR_WH_X), na.rm = TRUE), 0),\n    Other = pmax(rowSums(select(., SCH_ENR_AM_M, SCH_ENR_AM_F, SCH_ENR_AM_X,\n                                SCH_ENR_HP_M, SCH_ENR_HP_F, SCH_ENR_HP_X,\n                                SCH_ENR_TR_M, SCH_ENR_TR_F, SCH_ENR_TR_X), na.rm = TRUE), 0)\n  ) %>%\n  mutate(\n    Asian = round(Asian / Total_Enrollment * 100, 1),\n    Black = round(Black / Total_Enrollment * 100, 1),\n    Hispanic = round(Hispanic / Total_Enrollment * 100, 1),\n    White = round(White / Total_Enrollment * 100, 1),\n    Other = round(Other / Total_Enrollment * 100, 1)\n  ) %>%\n  select(SCH_NAME, Asian, Black, Hispanic, White, Other) %>%\n  arrange(match(SCH_NAME, top5$SCH_NAME))  # Match order\n\n# Print final racial breakdown table\nprint(race_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 6\n  SCH_NAME                                Asian Black Hispanic White Other\n  <chr>                                   <dbl> <dbl>    <dbl> <dbl> <dbl>\n1 Brockton High                             2.4  62       17    14.2   4.5\n2 Lawrence High School                      2.9   0       92.1   0     0  \n3 Cambridge Rindge and Latin               10.3  27.3     15.2  37.2  10  \n4 Lowell High                              29.6  11       35.1  20.8   3.9\n5 Gr Lowell Regional Vocational Technical  17.4   5.7     36.7  36.8   3.4\n```\n\n\n:::\n\n```{.r .cell-code}\n# Reshape data to long format for ggplot\nrace_long <- race_table %>%\n  pivot_longer(cols = Asian:Other, names_to = \"Race\", values_to = \"Percent\")\n\n# Plot stacked bar chart\nggplot(race_long, aes(x = reorder(SCH_NAME, -Percent), y = Percent, fill = Race)) +\n  geom_bar(stat = \"identity\") +\n  labs(\n    title = \"Racial Demographics of MA Schools with Top 5 Highest School Support Staff\",\n    x = \"School Name\",\n    y = \"Percentage of Enrollment\",\n    fill = \"Race\"\n  ) +\n  scale_y_continuous(labels = scales::percent_format(scale = 1)) +\n  scale_fill_manual(values = race_colors)+ \n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](suspension_analysis_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "suspension_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}