<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Exploring the Relationship Between School Support Services, Environment, and Disciplinary Outcomes in K–12 Education">

<title>Does School Support Improve Student Safety? – MA [46]15 Final Project TEAM 9</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project TEAM 9</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./big_picture.html" aria-current="page"> 
<span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./analysis.html"> 
<span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#why-is-analyzing-harassment-and-school-support-data-important" id="toc-why-is-analyzing-harassment-and-school-support-data-important" class="nav-link" data-scroll-target="#why-is-analyzing-harassment-and-school-support-data-important">Why is Analyzing Harassment and School Support Data Important?</a></li>
  <li><a href="#bully-data-analysis" id="toc-bully-data-analysis" class="nav-link" data-scroll-target="#bully-data-analysis">Bully Data Analysis</a>
  <ul class="collapse">
  <li><a href="#thesis" id="toc-thesis" class="nav-link" data-scroll-target="#thesis">Thesis</a></li>
  <li><a href="#interact-with-our-preliminary-analysis" id="toc-interact-with-our-preliminary-analysis" class="nav-link" data-scroll-target="#interact-with-our-preliminary-analysis">Interact with our Preliminary Analysis</a></li>
  <li><a href="#is-there-a-link-between-staff-and-safety" id="toc-is-there-a-link-between-staff-and-safety" class="nav-link" data-scroll-target="#is-there-a-link-between-staff-and-safety">Is There a Link Between Staff and Safety?</a></li>
  <li><a href="#key-finding-staff-presence-reduces-harassmentbut-only-partially" id="toc-key-finding-staff-presence-reduces-harassmentbut-only-partially" class="nav-link" data-scroll-target="#key-finding-staff-presence-reduces-harassmentbut-only-partially">Key Finding: Staff Presence Reduces Harassment—but Only Partially</a></li>
  <li><a href="#suspensions-a-different-story" id="toc-suspensions-a-different-story" class="nav-link" data-scroll-target="#suspensions-a-different-story">Suspensions: A Different Story</a></li>
  <li><a href="#deep-dive-massachusetts" id="toc-deep-dive-massachusetts" class="nav-link" data-scroll-target="#deep-dive-massachusetts">Deep Dive: Massachusetts</a>
  <ul class="collapse">
  <li><a href="#racial-disaggregation-reveals-inequity" id="toc-racial-disaggregation-reveals-inequity" class="nav-link" data-scroll-target="#racial-disaggregation-reveals-inequity">Racial Disaggregation Reveals Inequity</a></li>
  </ul></li>
  <li><a href="#conclusion-toward-equity-not-just-equality" id="toc-conclusion-toward-equity-not-just-equality" class="nav-link" data-scroll-target="#conclusion-toward-equity-not-just-equality">Conclusion: Toward Equity, Not Just Equality</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Does School Support Improve Student Safety?</h1>
</div>

<div>
  <div class="description">
    Exploring the Relationship Between School Support Services, Environment, and Disciplinary Outcomes in K–12 Education
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="images/TBP.png" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><strong>SAFE SCHOOLS FOR ALL</strong>: The foundational promise that schools are not only places of learning but also safe, inclusive environments where all students can thrive—regardless of race, disability, gender identity, or background. And yet, each year, thousands of students report experiencing bullying, harassment, and exclusion—often along lines of race, ability, or orientation. These are not isolated incidents, but part of a broader pattern that raises difficult questions: Why are some students disproportionately affected? What role does school infrastructure play? And perhaps most urgently—what can be done to disrupt this cycle?</p>
<p>We must ask ourselves: Is every student truly safe at school? Are disciplinary measures addressing harm, or reinforcing inequality? And how do support resources—or the lack thereof—shape these outcomes?</p>
</section>
<section id="why-is-analyzing-harassment-and-school-support-data-important" class="level2">
<h2 class="anchored" data-anchor-id="why-is-analyzing-harassment-and-school-support-data-important">Why is Analyzing Harassment and School Support Data Important?</h2>
<p>Analyzing public school data on harassment, bullying, and suspensions offers a critical lens into how educational environments succeed—or fail—to protect their most vulnerable students. By investigating the presence of school counselors, psychologists, and security staff alongside demographic and geographic variables, we can begin to identify patterns of disparity. Do more counselors correlate with fewer incidents? Are certain students more likely to be punished than protected?</p>
<p>This analysis helps uncover whether school resources are distributed equitably and whether their presence meaningfully impacts student safety and discipline outcomes. In doing so, we aim to contribute to a broader conversation about educational equity, institutional accountability, and the urgent need for reform.</p>
</section>
<section id="bully-data-analysis" class="level1">
<h1>Bully Data Analysis</h1>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="thesis" class="level2">
<h2 class="anchored" data-anchor-id="thesis">Thesis</h2>
<p><strong>The Support Gap</strong>: Examining the Link Between School Resources and Race-Based Harassment in U.S. Schools Racially-based harassment in U.S. schools remains persistently high across all states, highlighting a nationwide equity challenge in educational environments. However, our analysis reveals a consistent inverse relationship between the level of school-based support—such as counselors, psychologists, and security staff—and the frequency of race-related harassment incidents. These findings suggest that strengthening student support infrastructure may play a critical role in reducing race-based harassment and fostering safer, more inclusive learning environments.</p>
</section>
<section id="interact-with-our-preliminary-analysis" class="level2">
<h2 class="anchored" data-anchor-id="interact-with-our-preliminary-analysis">Interact with our Preliminary Analysis</h2>
<p><a href="https://baijie.shinyapps.io/shinyapp-harassment/">interactive graph</a></p>
<p>This interactive dashboard allowed us to explore the relationship between school staffing levels and reported harassment across different states in a dynamic, user-driven way. By visualizing the average number of counselors, nurses, psychologists, and security guards per 100 students alongside racial harassment incident rates, we were able to surface clear geographic patterns and disparities. These insights helped validate our thesis—that more robust support infrastructure correlates with lower rates of race-based harassment—and gave us the tools to investigate outliers and high-risk regions more deeply. ## From a National Lens to a Massachusetts Focus</p>
<p>Using data from the Civil Rights Data Collection (2021–2022), we observed that:</p>
<ul>
<li>Harassment rates vary sharply by <strong>identity and geography</strong></li>
<li><strong>Massachusetts</strong> had the <strong>highest normalized rate</strong> of harassment allegations by race, religion, and orientation</li>
<li>Students of color, especially <strong>Pacific Islander, Black, and Hispanic students</strong>, experience higher harassment per 100 students</li>
</ul>
<p>These trends pushed us to zoom in on Massachusetts for a closer, state-level look.</p>
</section>
<section id="is-there-a-link-between-staff-and-safety" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-link-between-staff-and-safety">Is There a Link Between Staff and Safety?</h2>
<p>We modeled harassment reports per 100 students against school support staffing using a log-log regression:</p>
<pre class="text"><code>log(harassment) = β₀ + β₁ × log(total_staff)</code></pre>
</section>
<section id="key-finding-staff-presence-reduces-harassmentbut-only-partially" class="level2">
<h2 class="anchored" data-anchor-id="key-finding-staff-presence-reduces-harassmentbut-only-partially">Key Finding: Staff Presence Reduces Harassment—but Only Partially</h2>
<p>A <strong>1% increase</strong> in total support staff correlates with a <strong>0.35% decrease</strong> in harassment rates per 100 students<br>
(<strong>β₁ = -0.352, R² = 0.08</strong>)</p>
<p>While the effect size is modest, the relationship is <strong>statistically significant</strong>—indicating that the presence of counselors, psychologists, nurses, and security staff has a measurable impact on student safety. However, this finding should be interpreted carefully:</p>
<ul>
<li>Staff presence alone doesn’t guarantee safety, and the small R² suggests that many other factors influence harassment rates—such as school climate, leadership, community context, and training.<br>
</li>
<li>The decrease in harassment is not uniform across all student groups—highlighting the need for targeted, culturally responsive interventions.</li>
</ul>
</section>
<section id="suspensions-a-different-story" class="level2">
<h2 class="anchored" data-anchor-id="suspensions-a-different-story">Suspensions: A Different Story</h2>
<p>No meaningful correlation was found between total support staff and suspension rates (<strong>R² &lt; 0.01</strong>).</p>
<p>In fact, <strong>in Massachusetts</strong>, the data showed a <strong>slight increase</strong> in suspension rates with higher support staffing.<br>
This counterintuitive result suggests that the role of support staff is more complex than simply acting as a buffer or moderator:</p>
<ul>
<li>Are support staff being used to support or to discipline?</li>
<li>Could better reporting mechanisms (from more staff) be driving reported suspension increases?</li>
<li>Do systemic biases in school discipline still override the protective effect of staff presence?</li>
</ul>
<p>These are critical questions that require deeper, perhaps qualitative, follow-up research.</p>
</section>
<section id="deep-dive-massachusetts" class="level2">
<h2 class="anchored" data-anchor-id="deep-dive-massachusetts">Deep Dive: Massachusetts</h2>
<p>Massachusetts reflects national patterns—but also reveals tensions:</p>
<ul>
<li><p><strong>Harassment</strong> and support staff show a <strong>negative correlation</strong><br>
<em>y = -0.376 - 0.325x, R² = 0.08</em>, suggesting more staff likely reduces bullying and harassment.</p></li>
<li><p><strong>Suspensions</strong> show a <strong>slight positive correlation</strong><br>
<em>y = 2.14 + 0.064x, R² = 0.02</em>—which, while not strong, suggests support staff may be embedded in systems that perpetuate punitive discipline.</p></li>
</ul>
<section id="racial-disaggregation-reveals-inequity" class="level3">
<h3 class="anchored" data-anchor-id="racial-disaggregation-reveals-inequity">Racial Disaggregation Reveals Inequity</h3>
<ul>
<li><strong>White, Hispanic, and Multiracial</strong> students appear to benefit the most from higher staffing levels.</li>
<li><strong>Native Hawaiian/Pacific Islander</strong> students show <strong>no clear benefit</strong>, despite experiencing the <strong>highest rates of harassment</strong>.</li>
</ul>
<p>This implies that infrastructure alone isn’t enough. Support staff must not only exist—but be:</p>
<ul>
<li>Culturally competent<br>
</li>
<li>Well-integrated into restorative frameworks<br>
</li>
<li>Empowered to challenge systemic biases</li>
</ul>
</section>
</section>
<section id="conclusion-toward-equity-not-just-equality" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-toward-equity-not-just-equality">Conclusion: Toward Equity, Not Just Equality</h2>
<p>Our data analysis points to a central truth:</p>
<p><strong>Support staff reduce harassment, but not automatically or equally.</strong></p>
<p>If we want safer schools, just hiring more people isn’t enough. We must also focus on:</p>
<ul>
<li>Training staff to be trauma-informed and inclusive<br>
</li>
<li>Allocating resources where they’re needed most<br>
</li>
<li>Embedding equity into staffing models, discipline systems, and school cultures</li>
</ul>
<p>As debates about school safety continue across the U.S., this work underscores a deeper need—not just for resources, but for reform rooted in justice, empathy, and community care.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/sussmanbu\.github\.io\/ma4615-sp25-final-project-team-9\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>