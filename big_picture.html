<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Exploring the Relationship Between School Support Services, Environment, and Disciplinary Outcomes in K‚Äì12 Education">

<title>MA [46]15 Final Project TEAM 9 - Does School Support Improve Student Safety?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project TEAM 9</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./big_picture.html" rel="" target="" aria-current="page">
 <span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./analysis.html" rel="" target="">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#thesis" id="toc-thesis" class="nav-link" data-scroll-target="#thesis">Thesis</a></li>
  <li><a href="#from-a-national-lens-to-a-massachusetts-focus" id="toc-from-a-national-lens-to-a-massachusetts-focus" class="nav-link" data-scroll-target="#from-a-national-lens-to-a-massachusetts-focus">From a National Lens to a Massachusetts Focus</a></li>
  <li><a href="#is-there-a-link-between-staff-and-safety" id="toc-is-there-a-link-between-staff-and-safety" class="nav-link" data-scroll-target="#is-there-a-link-between-staff-and-safety">Is There a Link Between Staff and Safety?</a></li>
  <li><a href="#rubric-other-components" id="toc-rubric-other-components" class="nav-link" data-scroll-target="#rubric-other-components">Rubric: Other components</a>
  <ul class="collapse">
  <li><a href="#video-recording" id="toc-video-recording" class="nav-link" data-scroll-target="#video-recording">Video Recording</a></li>
  <li><a href="#rest-of-the-site" id="toc-rest-of-the-site" class="nav-link" data-scroll-target="#rest-of-the-site">Rest of the Site</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Does School Support Improve Student Safety?</h1>
</div>

<div>
  <div class="description">
    Exploring the Relationship Between School Support Services, Environment, and Disciplinary Outcomes in K‚Äì12 Education
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="images/TBP.png" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><strong>SAFE SCHOOLS FOR ALL</strong>: The foundational promise that schools are not only places of learning but also safe, inclusive environments where all students can thrive‚Äîregardless of race, disability, gender identity, or background. And yet, each year, thousands of students report experiencing bullying, harassment, and exclusion‚Äîoften along lines of race, ability, or orientation. These are not isolated incidents, but part of a broader pattern that raises difficult questions: Why are some students disproportionately affected? What role does school infrastructure play? And perhaps most urgently‚Äîwhat can be done to disrupt this cycle?</p>
<p>We must ask ourselves: Is every student truly safe at school? Are disciplinary measures addressing harm, or reinforcing inequality? And how do support resources‚Äîor the lack thereof‚Äîshape these outcomes?</p>
<p>###Why is Analyzing Harassment and School Support Data Important?</p>
<p>Analyzing public school data on harassment, bullying, and suspensions offers a critical lens into how educational environments succeed‚Äîor fail‚Äîto protect their most vulnerable students. By investigating the presence of school counselors, psychologists, and security staff alongside demographic and geographic variables, we can begin to identify patterns of disparity. Do more counselors correlate with fewer incidents? Are certain students more likely to be punished than protected?</p>
<p>This analysis helps uncover whether school resources are distributed equitably and whether their presence meaningfully impacts student safety and discipline outcomes. In doing so, we aim to contribute to a broader conversation about educational equity, institutional accountability, and the urgent need for reform.</p>
<p><a href="https://baijie.shinyapps.io/shinyapp-harassment/">interactive graph</a></p>
<pre class="{library(shiny)}"><code>library(plotly)
library(highcharter)
library(fmsb)
library(dplyr)
library(readr)
library(tidyr)
library(stringr)
library(viridisLite)

# 2. Load dataset (keep it small!)
merged &lt;- read_csv("https://yourusername.github.io/yourrepo/scripts/merged_dataset_small.csv",
                   col_types = cols(.default = col_double(),
                                    LEA_STATE = col_character(),
                                    LEA_STATE_NAME = col_character()))

# Fix casing
merged$LEA_STATE_NAME &lt;- str_to_title(merged$LEA_STATE_NAME)

# Create state name/abbreviation mapping
state_codes &lt;- data.frame(
  LEA_STATE_NAME = state.name,
  state_code = state.abb
)

# Compute total enrollment and staff per 100
merged &lt;- merged %&gt;%
  mutate(
    total_enrollment = TOT_ENR_M + TOT_ENR_F + TOT_ENR_X
  ) %&gt;%
  filter(!is.na(total_enrollment) &amp; total_enrollment &gt; 0) %&gt;%
  mutate(
    counselors_per_100 = (SCH_FTECOUNSELORS / total_enrollment) * 100,
    nurses_per_100 = (SCH_FTESERVICES_NUR / total_enrollment) * 100,
    psychologists_per_100 = (SCH_FTESERVICES_PSY / total_enrollment) * 100,
    security_per_100 = (SCH_FTESECURITY_GUA / total_enrollment) * 100
  )

# Prepare state summary
state_summary &lt;- merged %&gt;%
  group_by(LEA_STATE_NAME) %&gt;%
  summarise(
    avg_counselors = mean(counselors_per_100, na.rm = TRUE),
    avg_nurses = mean(nurses_per_100, na.rm = TRUE),
    avg_psychologists = mean(psychologists_per_100, na.rm = TRUE),
    avg_security = mean(security_per_100, na.rm = TRUE)
  ) %&gt;%
  left_join(state_codes, by = "LEA_STATE_NAME") %&gt;%
  filter(!is.na(state_code))

# Prepare harassment data for map
enrollment_cols &lt;- c(
  "SCH_ENR_HI_M", "SCH_ENR_HI_F", "SCH_ENR_HI_X",
  "SCH_ENR_AM_M", "SCH_ENR_AM_F", "SCH_ENR_AM_X",
  "SCH_ENR_AS_M", "SCH_ENR_AS_F", "SCH_ENR_AS_X",
  "SCH_ENR_HP_M", "SCH_ENR_HP_F", "SCH_ENR_HP_X",
  "SCH_ENR_BL_M", "SCH_ENR_BL_F", "SCH_ENR_BL_X",
  "SCH_ENR_WH_M", "SCH_ENR_WH_F", "SCH_ENR_WH_X",
  "SCH_ENR_TR_M", "SCH_ENR_TR_F", "SCH_ENR_TR_X"
)

harassment_data &lt;- merged %&gt;%
  mutate(TOTAL_ENROLLMENT = rowSums(across(all_of(enrollment_cols)), na.rm = TRUE))

bullying_data &lt;- harassment_data %&gt;%
  group_by(LEA_STATE) %&gt;%
  summarise(
    total_allegations = sum(HBALLEGATIONS_RAC + HBALLEGATIONS_REL + HBALLEGATIONS_ORI, na.rm = TRUE),
    total_students = sum(TOTAL_ENROLLMENT, na.rm = TRUE),
    .groups = "drop"
  ) %&gt;%
  mutate(rate_per_100 = round(total_allegations / total_students * 100, 2)) %&gt;%
  mutate(`hc-key` = paste0("us-", tolower(LEA_STATE)))

# --- UI ---
ui &lt;- fluidPage(
  titlePanel("School Staffing and Harassment Visualization"),
  tabsetPanel(
    tabPanel("Staffing Map",
             sidebarLayout(
               sidebarPanel(
                 selectInput("map_metric", "Select Staff Type:", choices = c(
                   "Counselors" = "avg_counselors",
                   "Nurses" = "avg_nurses",
                   "Psychologists" = "avg_psychologists",
                   "Security Guards" = "avg_security"
                 )),
                 selectInput("selected_state", "Select a State for Radar Chart:",
                             choices = sort(unique(merged$LEA_STATE_NAME)),
                             selected = "Massachusetts")
               ),
               mainPanel(
                 plotlyOutput("us_map"),
                 plotOutput("radar_chart")
               )
             )
    ),
    tabPanel("Bullying Rate Map",
             highchartOutput("bullying_map", height = "700px")
    )
  )
)

# --- Server ---
server &lt;- function(input, output, session) {
  selected_state &lt;- reactiveVal("Massachusetts")
  
  output$us_map &lt;- renderPlotly({
    plot_ly(
      data = state_summary,
      type = "choropleth",
      locations = ~state_code,
      locationmode = "USA-states",
      z = ~get(input$map_metric),
      key = ~state_code,
      text = ~paste(LEA_STATE_NAME, "&lt;br&gt;", round(get(input$map_metric), 2), "per 100 students"),
      colorscale = "YlGnBu",
      hoverinfo = "text",
      colorbar = list(title = "Staff per 100")
    ) %&gt;%
      layout(geo = list(scope = 'usa'), title = "Click a state to see staffing breakdown", clickmode = "event+select")
  })
  
  observeEvent(event_data("plotly_click"), {
    click &lt;- event_data("plotly_click")
    if (!is.null(click)) {
      state_name &lt;- state_codes$LEA_STATE_NAME[state_codes$state_code == click$key]
      if (length(state_name) &gt; 0) {
        updateSelectInput(session, "selected_state", selected = state_name)
        selected_state(state_name)
      }
    }
  })
  
  output$radar_chart &lt;- renderPlot({
    state_data &lt;- merged %&gt;%
      filter(LEA_STATE_NAME == input$selected_state) %&gt;%
      summarise(
        Counselors = mean(SCH_FTECOUNSELORS, na.rm = TRUE),
        Nurses = mean(SCH_FTESERVICES_NUR, na.rm = TRUE),
        Psychologists = mean(SCH_FTESERVICES_PSY, na.rm = TRUE),
        Security_Guards = mean(SCH_FTESECURITY_GUA, na.rm = TRUE)
      )
    
    chart_data &lt;- rbind(
      c(4, 2, 1.5, 3),
      c(0, 0, 0, 0),
      state_data
    )
    
    radarchart(chart_data,
               axistype = 1,
               pcol = "darkblue",
               pfcol = rgb(0.1, 0.4, 0.7, 0.5),
               plwd = 2,
               cglcol = "grey",
               cglty = 1,
               axislabcol = "black",
               caxislabels = c(0, 1, 2, 3, 4),
               vlcex = 0.9,
               title = paste("Avg Staff per School in", input$selected_state))
  })
  
  output$bullying_map &lt;- renderHighchart({
    hcmap(
      "countries/us/us-all",
      data = bullying_data,
      name = "Allegations per 100 students",
      value = "rate_per_100",
      joinBy = c("hc-key", "hc-key"),
      borderWidth = 0,
      nullColor = "#d3d3d3"
    ) %&gt;%
      hc_colorAxis(
        stops = color_stops(colors = inferno(10)),
        min = 0
      ) %&gt;%
      hc_title(text = "Harassment/Bullying Allegations per 100 Students by State") %&gt;%
      hc_tooltip(pointFormat = "{point.name}: {point.value}")
  })
}

# --- Launch App ---
shinyApp(ui, server)


</code></pre>
</section>
<section id="thesis" class="level2">
<h2 class="anchored" data-anchor-id="thesis">Thesis</h2>
<p><strong>The Support Gap</strong>: Examining the Link Between School Resources and Race-Based Harassment in U.S. Schools Racially-based harassment in U.S. schools remains persistently high across all states, highlighting a nationwide equity challenge in educational environments. However, our analysis reveals a consistent inverse relationship between the level of school-based support‚Äîsuch as counselors, psychologists, and security staff‚Äîand the frequency of race-related harassment incidents. These findings suggest that strengthening student support infrastructure may play a critical role in reducing race-based harassment and fostering safer, more inclusive learning environments.</p>
</section>
<section id="from-a-national-lens-to-a-massachusetts-focus" class="level2">
<h2 class="anchored" data-anchor-id="from-a-national-lens-to-a-massachusetts-focus">From a National Lens to a Massachusetts Focus</h2>
<p>Using data from the Civil Rights Data Collection (2021‚Äì2022), we observed that:</p>
<ul>
<li>Harassment rates vary sharply by <strong>identity and geography</strong></li>
<li><strong>Massachusetts</strong> had the <strong>highest normalized rate</strong> of harassment allegations by race, religion, and orientation</li>
<li>Students of color, especially <strong>Pacific Islander, Black, and Hispanic students</strong>, experience higher harassment per 100 students</li>
</ul>
<p>These trends pushed us to zoom in on Massachusetts for a closer, state-level look.</p>
<hr>
</section>
<section id="is-there-a-link-between-staff-and-safety" class="level2">
<h2 class="anchored" data-anchor-id="is-there-a-link-between-staff-and-safety">Is There a Link Between Staff and Safety?</h2>
<p>We modeled harassment reports per 100 students against school support staffing using a log-log regression:</p>
<pre class="text"><code>log(harassment) = Œ≤‚ÇÄ + Œ≤‚ÇÅ √ó log(total_staff)</code></pre>
<p>üìâ <strong>Key Result</strong>:<br>
A 1% increase in support staff is associated with a <strong>0.35% decrease</strong> in race-based harassment rates (Œ≤‚ÇÅ = -0.352, R¬≤ = 0.08)</p>
<p>But the link is modest‚Äîand not all students benefit equally.</p>
</section>
<section id="rubric-other-components" class="level2">
<h2 class="anchored" data-anchor-id="rubric-other-components">Rubric: Other components</h2>
<section id="video-recording" class="level3">
<h3 class="anchored" data-anchor-id="video-recording">Video Recording</h3>
<p>Make a video recording (probably using Zoom) demonstrating your interactive components. You should provide a quick explanation of your data and demonstrate some of the conclusions from your EDA. This video should be no longer than 4 minutes. Include a link to your video (and password if needed) in your README.md file on your Github repository. You are not required to provide a link on the website. This can be presented by any subset of the team members.</p>
</section>
<section id="rest-of-the-site" class="level3">
<h3 class="anchored" data-anchor-id="rest-of-the-site">Rest of the Site</h3>
<p>Finally, here are important things to keep in mind for the rest of the site.</p>
<p>The main title of your page is informative. Each post has an author/descr iption/informative title. All lab required posts are present. Each page (including the home page) has a nice featured image associated with it. Your about page is up to date and clean. You have removed the generic posts from the initial site template.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>